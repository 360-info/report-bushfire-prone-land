{
  "hash": "e46caa625e907351ad85c23577366ef9",
  "result": {
    "markdown": "---\ntitle: Historical Bushfire Boundaries\nsubtitle: Locations and extents of historical bushfires and burning events, from Geoscience Australia (GA).\nformat:\n  360-analysis-html: default\nauthor: Dean Marchiori\ndate: last-modified\ncode-fold: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at /home/wavedatalabs/Documents/wd/report-bushfire-prone-land\n```\n:::\n\n```{.r .cell-code}\nlibrary(gganimate)\nlibrary(ggmap)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nℹ Google's Terms of Service: <https://mapsplatform.google.com>\nℹ Please cite ggmap if you use it! Use `citation(\"ggmap\")` for details.\n```\n:::\n\n```{.r .cell-code}\nlibrary(themes360info)\n\n# Requires transformr v0.1.3 due to unresolved bug in newer version \n#devtools::install_version(\"transformr\", version = \"0.1.3\")\n```\n:::\n\n\nRead in data. For source and info see `data/README.md`  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nfires_raw <- read_sf(here(\"data/raw/fire_history/Historical_Bushfire_Boundaries.geojson\"))\n```\n:::\n\n\nProcess data to keep SE Australia busfires only (not prescribed burns) from 2000 onwards. Many fires did not have an `ignition_date` so these were removed. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nfires <- fires_raw |>\n    filter(\n        state %in% c(\n            \"ACT (Australian Capital Territory)\",\n            \"NSW (New South Wales)\", \n            \"VIC (Victoria)\", \n            \"TAS (Tasmania)\",\n            \"QLD (Queensland)\",\n            \"SA (South Australia)\"\n        ),\n        fire_type == \"Bushfire\",\n        !is.na(ignition_date)\n    ) |>\n    mutate(year = year(ignition_date)) |>\n    select(year) |>\n    filter(year > 2000) |>\n    st_make_valid() |>\n    st_transform(3857)  |>\n    group_by(year) |>\n    summarise(geometry = st_union(geometry)) |>\n    rmapshaper::ms_simplify(keep_shapes = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nThe legacy packages maptools, rgdal, and rgeos, underpinning the sp package,\nwhich was just loaded, will retire in October 2023.\nPlease refer to R-spatial evolution reports for details, especially\nhttps://r-spatial.org/r/2023/05/15/evolution4.html.\nIt may be desirable to make the sf package available;\npackage maintainers should consider adding sf to Suggests:.\nThe sp package is now running under evolution status 2\n     (status 2 uses the sf package in place of rgdal)\n```\n:::\n:::\n\n\nMaking an animated map with a satellite basemap. The basemap from from the Google API and requires an API key.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Supply API key here\n# register_google(key = \"xxx\")\n\nmap <- get_googlemap(\n    center = c(\n        lon = 144.5115485,\n        lat = -38.1184925\n    ),\n    zoom = 5, \n    maptype = \"satellite\"\n)\n\n# Define a function to fix the bbox to be in EPSG:3857\nggmap_bbox <- function(map) {\n  if (!inherits(map, \"ggmap\")) stop(\"map must be a ggmap object\")\n  # Extract the bounding box (in lat/lon) from the ggmap to a numeric vector, \n  # and set the names to what sf::st_bbox expects:\n  map_bbox <- setNames(unlist(attr(map, \"bb\")), \n                       c(\"ymin\", \"xmin\", \"ymax\", \"xmax\"))\n\n  # Coonvert the bbox to an sf polygon, transform it to 3857, \n  # and convert back to a bbox (convoluted, but it works)\n  bbox_3857 <- st_bbox(st_transform(st_as_sfc(st_bbox(map_bbox, crs = 4326)), 3857))\n\n  # Overwrite the bbox of the ggmap object with the transformed coordinates \n  attr(map, \"bb\")$ll.lat <- bbox_3857[\"ymin\"]\n  attr(map, \"bb\")$ll.lon <- bbox_3857[\"xmin\"]\n  attr(map, \"bb\")$ur.lat <- bbox_3857[\"ymax\"]\n  attr(map, \"bb\")$ur.lon <- bbox_3857[\"xmax\"]\n  map\n}\n\n# Use the function:\nmap <- ggmap_bbox(map)\n\n# produce animation \nanim <- ggmap(map) +\n    geom_sf(data = fires, aes(group = year), fill = \"red\", lwd = 0, alpha = 0.4, inherit.aes = FALSE) +\n    theme_void() +\n    transition_time(year) +\n    gganimate::shadow_wake(0.25) + \n    labs(title = \"Year: {round(frame_time,0)}\") +\n    coord_sf(crs = st_crs(3857))\n\n# export as a library of pngs\nanimate(anim, renderer = file_renderer(dir = \"output/anim\"), width = 6, height = 6, units = \"in\", res = 300)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}